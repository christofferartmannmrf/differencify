{"version":3,"sources":["../../src/helpers/proxyChain.js"],"names":["ChainObject","constructor","target","options","currentTarget","actions","setCurrentTarget","addAction","property","undefined","args","push","end","result","continueChain","action","_handleContinueFunc","continueFunc","resultFunc","apply","funcHandler","makeHandler","get","chainObj","chained","moduleList","includes","handle","arguments","endFunc","then","catch","e","logger","trace","chainedTarget","set","name","value","Error","chain","defaultParams","chainObject","Proxy","module","exports"],"mappings":"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","file":"proxyChain.js","sourcesContent":["/* eslint-disable prefer-rest-params, no-await-in-loop */\nimport logger from '../utils/logger';\nimport moduleList from './moduleList';\n\nclass ChainObject {\n  constructor(target, options) {\n    this.target = target;\n    this.options = options;\n    this.currentTarget = 'page';\n    this.actions = [];\n  }\n\n  setCurrentTarget(currentTarget) {\n    this.currentTarget = currentTarget;\n  }\n\n  addAction({\n    target = this.currentTarget,\n    property = undefined,\n    args = undefined,\n  } = {}) {\n    this.actions.push({ target, property, args });\n  }\n\n  async end() {\n    let result = null;\n    let continueChain = false;\n    const { actions } = this;\n    this.actions = [];\n    // eslint-disable-next-line no-restricted-syntax\n    for (const action of actions) {\n      if (continueChain) {\n        result = await this.target._handleContinueFunc(result, action.property, action.args);\n        continueChain = false;\n      } else if (action.property === this.options.continueFunc) {\n        continueChain = true;\n      } else if (action.property === this.options.resultFunc) {\n        result = await action.args[0].apply(null, [result]);\n      } else {\n        result = await this.target[this.options.funcHandler](action.target, action.property, action.args);\n      }\n    }\n    return result;\n  }\n}\n\nconst makeHandler = (target, options) => ({\n  get: (chainObj, property) => {\n    if (!options.chained) {\n      return (moduleList.includes(property))\n        ? target[options.funcHandler]('page', property)\n        : function handle() {\n          return target[options.funcHandler]('page', property, arguments);\n        };\n    }\n    if (property === options.endFunc) {\n      return () => chainObj.end()\n        .then(result => result)\n        .catch((e) => {\n          logger.trace(e);\n          throw e;\n        });\n    }\n    if (moduleList.includes(property)) {\n      chainObj.setCurrentTarget(property);\n      return target.chainedTarget;\n    }\n    if (property === options.continueFunc) {\n      chainObj.addAction({ property });\n      return target.chainedTarget;\n    }\n    return function handle() {\n      chainObj.addAction({ property, args: arguments });\n      return this;\n    };\n  },\n  set: (chainObj, name, value) => {\n    throw new Error(`You cannot set a ${value} to Proxy object.`);\n  },\n});\n\nconst chain = (target, chained = true) => {\n  const defaultParams = {\n    resultFunc: 'result',\n    endFunc: 'end',\n    continueFunc: 'then',\n    funcHandler: '_handleFunc',\n    chained,\n  };\n  const chainObject = new ChainObject(target, defaultParams);\n  return new Proxy(\n    chainObject,\n    makeHandler(target, defaultParams),\n  );\n};\n\nmodule.exports = chain;\n"]}