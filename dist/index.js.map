{"version":3,"sources":["../src/index.js"],"names":["Differencify","constructor","conf","debug","logger","enable","configuration","browser","testId","launchBrowser","options","log","puppeteer","launch","error","trace","executablePath","chromeExecutablePath","connectBrowser","connect","init","config","testConfig","isUpdate","warn","target","Target","isJest","chainedTarget","chain","cleanup","close","module","exports"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;;;AAEe,MAAMA,YAAN,CAAmB;AAChCC,cAAYC,IAAZ,EAAkB;AAChB,QAAIA,QAAQA,KAAKC,KAAL,KAAe,IAA3B,EAAiC;AAC/BC,uBAAOC,MAAP;AACD;AACD,SAAKC,aAAL,GAAqB,4CAA4BJ,IAA5B,CAArB;AACA,SAAKK,OAAL,GAAe,IAAf;AACA,SAAKC,MAAL,GAAc,CAAd;AACD;;AAED,QAAMC,aAAN,CAAoBC,OAApB,EAA6B;AAC3B,QAAI,CAAC,KAAKH,OAAV,EAAmB;AACjBH,uBAAOO,GAAP,CAAW,sBAAX;AACA,UAAI;AACF,aAAKJ,OAAL,GAAe,MAAMK,oBAAUC,MAAV,CAAiBH,OAAjB,CAArB;AACD,OAFD,CAEE,OAAOI,KAAP,EAAc;AACdV,yBAAOW,KAAP,CAAaD,KAAb;AACD;AACF,KAPD,MAOO;AACLV,uBAAOO,GAAP,CAAW,iCAAX;AACD;AACF;;AAED,SAAOK,cAAP,GAAwB;AACtB,WAAOJ,oBAAUI,cAAV,EAAP;AACD;;AAED,SAAOC,oBAAP,GAA8B;AAC5B,WAAOL,oBAAUI,cAAV,EAAP;AACD;;AAED,QAAMH,MAAN,CAAaH,OAAb,EAAsB;AACpB,SAAKD,aAAL,CAAmBC,OAAnB;AACD;;AAED,QAAMQ,cAAN,CAAqBR,OAArB,EAA8B;AAC5B,QAAI,CAAC,KAAKH,OAAV,EAAmB;AACjBH,uBAAOO,GAAP,CAAW,sBAAX;AACA,UAAI;AACF,aAAKJ,OAAL,GAAe,MAAMK,oBAAUO,OAAV,CAAkBT,OAAlB,CAArB;AACD,OAFD,CAEE,OAAOI,KAAP,EAAc;AACdV,yBAAOW,KAAP,CAAaD,KAAb;AACD;AACF,KAPD,MAOO;AACLV,uBAAOO,GAAP,CAAW,iCAAX;AACD;AACF;;AAED,QAAMQ,OAAN,CAAcT,OAAd,EAAuB;AACrB,SAAKQ,cAAL,CAAoBR,OAApB;AACD;;AAEDU,OAAKC,MAAL,EAAa;AACX,SAAKb,MAAL,IAAe,CAAf;AACA,UAAMc,aAAa,0CAA0BD,MAA1B,EAAkC,KAAKb,MAAvC,CAAnB;AACA,QAAIc,WAAWC,QAAf,EAAyB;AACvBnB,uBAAOoB,IAAP,CAAY,yEAAZ;AACD;AACD,UAAMC,SAAS,IAAIC,gBAAJ,CAAW,KAAKnB,OAAhB,EAAyB,KAAKD,aAA9B,EAA6CgB,UAA7C,CAAf;AACAG,WAAOE,MAAP;AACA,UAAMC,gBAAgB,0BAAMH,MAAN,EAAcH,WAAWO,KAAzB,CAAtB;AACAJ,WAAOG,aAAP,GAAuBA,aAAvB;AACA,WAAOA,aAAP;AACD;;AAED,QAAME,OAAN,GAAgB;AACd1B,qBAAOO,GAAP,CAAW,oBAAX;AACA,QAAI;AACF,UAAI,KAAKJ,OAAT,EAAkB;AAChB,cAAM,KAAKA,OAAL,CAAawB,KAAb,EAAN;AACD;AACF,KAJD,CAIE,OAAOjB,KAAP,EAAc;AACdV,uBAAOW,KAAP,CAAaD,KAAb;AACD;AACF;AA1E+B;;kBAAbd,Y;AA6ErBgC,OAAOC,OAAP,GAAiBjC,YAAjB","file":"index.js","sourcesContent":["import puppeteer from 'puppeteer';\nimport chain from './helpers/proxyChain';\nimport { sanitiseGlobalConfiguration, sanitiseTestConfiguration } from './sanitiser';\nimport Target from './target';\nimport logger from './utils/logger';\n\nexport default class Differencify {\n  constructor(conf) {\n    if (conf && conf.debug === true) {\n      logger.enable();\n    }\n    this.configuration = sanitiseGlobalConfiguration(conf);\n    this.browser = null;\n    this.testId = 0;\n  }\n\n  async launchBrowser(options) {\n    if (!this.browser) {\n      logger.log('Launching browser...');\n      try {\n        this.browser = await puppeteer.launch(options);\n      } catch (error) {\n        logger.trace(error);\n      }\n    } else {\n      logger.log('Using existing browser instance');\n    }\n  }\n\n  static executablePath() {\n    return puppeteer.executablePath();\n  }\n\n  static chromeExecutablePath() {\n    return puppeteer.executablePath();\n  }\n\n  async launch(options) {\n    this.launchBrowser(options);\n  }\n\n  async connectBrowser(options) {\n    if (!this.browser) {\n      logger.log('Launching browser...');\n      try {\n        this.browser = await puppeteer.connect(options);\n      } catch (error) {\n        logger.trace(error);\n      }\n    } else {\n      logger.log('Using existing browser instance');\n    }\n  }\n\n  async connect(options) {\n    this.connectBrowser(options);\n  }\n\n  init(config) {\n    this.testId += 1;\n    const testConfig = sanitiseTestConfiguration(config, this.testId);\n    if (testConfig.isUpdate) {\n      logger.warn('Your tests are running on update mode. Test screenshots will be updated');\n    }\n    const target = new Target(this.browser, this.configuration, testConfig);\n    target.isJest();\n    const chainedTarget = chain(target, testConfig.chain);\n    target.chainedTarget = chainedTarget;\n    return chainedTarget;\n  }\n\n  async cleanup() {\n    logger.log('Closing browser...');\n    try {\n      if (this.browser) {\n        await this.browser.close();\n      }\n    } catch (error) {\n      logger.trace(error);\n    }\n  }\n}\n\nmodule.exports = Differencify;\n"]}